{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <link href="{% static 'css/products.css' %}" rel="stylesheet" />
</head>
<body>
  {% include 'Components/header.html' %}

  <div class="breadcrumb">
    {% if selected_category %}{{ selected_category.name }}{% endif %}
    {% if selected_subcategory %} > {{ selected_subcategory.name }}{% endif %}
    {% if selected_room %} > {{ selected_room.room_name }}{% endif %}
  </div>

  <h1 class="category-title">
    {% if selected_subcategory %}
      {{ selected_subcategory.name }}
    {% elif selected_category %}
      {{ selected_category.name }}
    {% else %}
      All Products
    {% endif %}
  </h1>

  <div class="filters">
    <form method="GET">
      <select name="price">
        <option value="">Price</option>
        <option value="0-2000" {% if price == '0-2000' %}selected{% endif %}>Under £2000</option>
        <option value="5000-10000" {% if price == '5000-10000' %}selected{% endif %}>£5000 - £10000</option>
        <option value="10000-20000" {% if price == '10000-20000' %}selected{% endif %}>£10000 - £20000</option>
        <option value="20000+" {% if price == '20000+' %}selected{% endif %}>Above £20000</option>
      </select>

      <select name="room">
        <option value="">Room</option>
        {% for room in rooms %}
          <option value="{{ room.id }}" {% if room.id|stringformat:"s" == request.GET.room %}selected{% endif %}>{{ room.room_name }}</option>
        {% endfor %}
      </select>

      <select name="category">
        <option value="">Category</option>
        {% for category in categories %}
          <option value="{{ category.id }}" {% if category.id|stringformat:"s" == request.GET.category %}selected{% endif %}>{{ category.name }}</option>
        {% endfor %}
      </select>

      <select name="subcategory">
        <option value="">Sub Category</option>
        {% for sub in subcategories %}
          <option value="{{ sub.id }}" {% if sub.id|stringformat:"s" == request.GET.subcategory %}selected{% endif %}>{{ sub.name }}</option>
        {% endfor %}
      </select>

      <button type="submit">Filter</button>
    </form>
  </div>

  <div class="product-grid">
    {% for product in products %}
      <div class="card">
          <div class="subcategory">{{ product.subcategory|default:"sub" }}</div>
        <div class="colors">
          <span style="background: {{ product.color1|default:'#999' }}"></span>
          <span style="background: {{ product.color2|default:'#ccc' }}"></span>
        </div>
        <a href="{% url 'product' product.id %}">
          <img src="{{ product.image.url }}" alt="{{ product.name }}" />
        </a>
        <div class="bottom-circle">
          <span>{{ product.brand|default:"BRAND" }}</span>
          <span class="price">{{ product.price }}£ <i class="fa-solid fa-coins"></i></span>
        </div>
        <form method="POST" action="{% url 'cart_actions' product.id %}">
          {% csrf_token %}
          <input type="hidden" name="quantity" value="1" />
          <button type="submit" class="cart-icon-btn">
            <i class="fas fa-cart-plus cart-icon"></i>
          </button>
        </form>
      </div>
    {% empty %}
      <p>No products found.</p>
    {% endfor %}
  </div>

  {% if is_paginated %}
    <div class="pagination">
      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}">&laquo;</a>
      {% endif %}
      {% for num in page_obj.paginator.page_range %}
        {% if num == page_obj.number %}
          <button class="current">{{ num }}</button>
        {% else %}
          <a href="?page={{ num }}">{{ num }}</a>
        {% endif %}
      {% endfor %}
      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">&raquo;</a>
      {% endif %}
    </div>
  {% endif %}

  {% include 'Components/footer.html' %}
  <script src="{% static 'js/User/products.js' %}"></script>
</body>
</html>
